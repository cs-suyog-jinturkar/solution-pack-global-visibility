{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Get Data From Configured Sites",
    "aliasName": null,
    "tag": null,
    "description": "Get data from all sites configured in remote FortiSOAR connector",
    "isActive": true,
    "debug": true,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "siteData"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/09e854ab-ec45-4705-8eeb-5d498c3bc5cc",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/5d464431-d509-4b23-866b-6cd18703e136",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Active Incidents",
            "description": null,
            "arguments": {
                "name": "Remote FortiSOAR",
                "config": "{{vars.input.params.siteData.siteName}}",
                "params": {
                    "iri": "\/api\/query\/incidents",
                    "body": "{\n    \"sort\": [\n        {\n            \"field\": \"modifyDate\",\n            \"direction\": \"DESC\"\n        }\n    ],\n    \"limit\": 30,\n    \"logic\": \"AND\",\n    \"filters\": [\n        {\n            \"field\": \"status\",\n            \"value\": [\n                \"\/api\/3\/picklists\/bb73fe9e-f699-11e7-8c3f-9a214cf093ae\"\n            ],\n            \"display\": \"\",\n            \"operator\": \"in\",\n            \"type\": \"array\",\n            \"OPERATOR_KEY\": \"$\"\n        },\n        {\n            \"sort\": [],\n            \"limit\": 30,\n            \"logic\": \"AND\",\n            \"filters\": []\n        }\n    ],\n    \"__selectFields\": [\n        \"id\"\n    ]\n}",
                    "method": "POST",
                    "params": "",
                    "headers": "{\"accept\": \"application\/json\"}"
                },
                "version": "1.0.0",
                "connector": "remote-fortisoar",
                "operation": "make_api_call",
                "operationTitle": "Make an API call",
                "pickFromTenant": false,
                "step_variables": {
                    "activeIncidentCount": "{{vars.steps.Active_Incidents.data['hydra:totalItems']}}"
                }
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "db60d493-2b2f-4201-a639-44415959f6ed"
        },
        {
            "@type": "WorkflowStep",
            "name": "Alerts",
            "description": null,
            "arguments": {
                "name": "Remote FortiSOAR",
                "config": "{{vars.input.params.siteData.siteName}}",
                "params": {
                    "iri": "\/api\/3\/alerts",
                    "method": "GET",
                    "params": "",
                    "headers": "{\"accept\": \"application\/json\"}"
                },
                "version": "1.0.0",
                "connector": "remote-fortisoar",
                "operation": "make_api_call",
                "operationTitle": "Make an API call",
                "pickFromTenant": false,
                "step_variables": {
                    "alertsCount": "{{vars.steps.Alerts.data['hydra:totalItems']}}"
                }
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "cab7efe7-798c-4984-921d-2baac71ab94d"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "alert": "",
                "incident": "",
                "indicator": ""
            },
            "status": null,
            "top": "165",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "3dfc147b-d616-40a8-8158-a2b25539e1b0"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Tenant Alerts",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.steps.Tenant_List.data['hydra:member']}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "siteName": "{{vars.input.params.siteData.siteName}}",
                    "tenantData": "{{vars.item}}"
                },
                "apply_async": false,
                "step_variables": {
                    "tenantData": "{{vars.steps.Get_Tenant_Alerts | json_query( '[*][\"alertsCount\"][]') | flatten}}",
                    "tenantIncidentData": "{{vars.steps.Get_Tenant_Alerts | json_query( '[*][\"incidentCount\"][]') | flatten}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/23a1143c-a41e-40f3-ac01-34023b347ad5"
            },
            "status": null,
            "top": "705",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "1afa0ad3-c803-4e6d-a976-238a08df9e63"
        },
        {
            "@type": "WorkflowStep",
            "name": "Incidents",
            "description": null,
            "arguments": {
                "name": "Remote FortiSOAR",
                "config": "{{vars.input.params.siteData.siteName}}",
                "params": {
                    "iri": "\/api\/3\/incidents",
                    "method": "GET",
                    "params": "",
                    "headers": "{\"accept\": \"application\/json\"}"
                },
                "version": "1.0.0",
                "connector": "remote-fortisoar",
                "operation": "make_api_call",
                "operationTitle": "Make an API call",
                "pickFromTenant": false,
                "step_variables": {
                    "incidentCount": "{{vars.steps.Incidents.data['hydra:totalItems']}}"
                }
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "27e907f4-e4c4-46af-a782-a96f3fa30060"
        },
        {
            "@type": "WorkflowStep",
            "name": "Indicators",
            "description": null,
            "arguments": {
                "name": "Remote FortiSOAR",
                "config": "{{vars.input.params.siteData.siteName}}",
                "params": {
                    "iri": "\/api\/3\/indicators",
                    "method": "GET",
                    "params": "",
                    "headers": "{\"accept\": \"application\/json\"}"
                },
                "version": "1.0.0",
                "connector": "remote-fortisoar",
                "operation": "make_api_call",
                "operationTitle": "Make an API call",
                "pickFromTenant": false,
                "step_variables": {
                    "indicatorsCount": "{{vars.steps.Indicators.data['hydra:totalItems']}}"
                }
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "d836e8ce-bffb-4b7b-ba88-b18801aaa7f2"
        },
        {
            "@type": "WorkflowStep",
            "name": "Output",
            "description": null,
            "arguments": {
                "alert": "{{vars.alertsCount}}",
                "incident": "{{vars.incidentCount}}",
                "indicator": "{{vars.indicatorsCount}}"
            },
            "status": null,
            "top": "1245",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "bca368db-03af-4560-862e-c4b8aadd840d"
        },
        {
            "@type": "WorkflowStep",
            "name": "Record to update",
            "description": null,
            "arguments": {
                "query": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": [
                        {
                            "type": "primitive",
                            "field": "siteName",
                            "value": "{{vars.input.params.siteData.siteName}}",
                            "operator": "eq",
                            "_operator": "eq"
                        }
                    ]
                },
                "module": "global_visibility_data?$limit=30",
                "step_variables": []
            },
            "status": null,
            "top": "975",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928770",
            "group": null,
            "uuid": "507faaf9-10da-44f1-a661-069b80f00b2a"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    }
                }
            },
            "status": null,
            "top": "30",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "5d464431-d509-4b23-866b-6cd18703e136"
        },
        {
            "@type": "WorkflowStep",
            "name": "Tenant Data",
            "description": null,
            "arguments": {
                "tenantData": "{% set result = {} %}\n{% for item in vars.tenantData %}\n  {% for key, value in item.items() %}\n    {% set _ = result.update({key: value}) %}\n  {% endfor %}\n{% endfor %}\n{{ result }}",
                "totalTenants": "{{vars.steps.Tenant_List.data['hydra:totalItems']}}",
                "tenantIncidents": "{% set result = {} %}\n{% for item in vars.tenantIncidentData %}\n  {% for key, value in item.items() %}\n    {% set _ = result.update({key: value}) %}\n  {% endfor %}\n{% endfor %}\n{{ result }}"
            },
            "status": null,
            "top": "840",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "6ec1b065-4635-478d-84db-942a273e81b3"
        },
        {
            "@type": "WorkflowStep",
            "name": "Tenant List",
            "description": null,
            "arguments": {
                "name": "Remote FortiSOAR",
                "config": "{{vars.input.params.siteData.siteName}}",
                "params": {
                    "iri": "\/api\/3\/tenants",
                    "method": "GET",
                    "params": "",
                    "headers": "{\"accept\": \"application\/json\"}"
                },
                "version": "1.0.0",
                "connector": "remote-fortisoar",
                "operation": "make_api_call",
                "operationTitle": "Make an API call",
                "pickFromTenant": false,
                "step_variables": []
            },
            "status": null,
            "top": "570",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "b6011002-8390-4895-9338-e69dd05c2760"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update Site Data",
            "description": null,
            "arguments": {
                "resource": {
                    "dashboardData": {
                        "funnelChart": {
                            "alerts": "{{vars.alertsCount}}",
                            "warrooms": "{{vars.warroomsCount}}",
                            "incidents": "{{vars.incidentCount}}",
                            "indicators": "{{vars.indicatorsCount}}"
                        },
                        "topXbyAlerts": "{{vars.tenantData}}",
                        "topXbyIncidents": "{{vars.tenantIncidents}}",
                        "recordSummaryCard": {
                            "data": {
                                "ROI": "$37,707",
                                "MTTD": "1 min",
                                "MTTR": "2 mins",
                                "Node Status": "Active",
                                "Total Tenants": "{{vars.totalTenants}}",
                                "Active Incidents": "{{vars.activeIncidentCount}}"
                            },
                            "title": "{{vars.input.params.siteData.siteName}}"
                        }
                    }
                },
                "operation": "Append",
                "collection": "{{vars.steps.Record_to_update[0]['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/global_visibility_data",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": {
                    "X": ""
                }
            },
            "status": null,
            "top": "1110",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "bb506c49-fa25-4250-87d7-7cbaa6c31a39"
        },
        {
            "@type": "WorkflowStep",
            "name": "Warrooms",
            "description": null,
            "arguments": {
                "name": "Remote FortiSOAR",
                "config": "{{vars.input.params.siteData.siteName}}",
                "params": {
                    "iri": "\/api\/3\/warrooms",
                    "method": "GET",
                    "params": "",
                    "headers": "{\"accept\": \"application\/json\"}"
                },
                "version": "1.0.0",
                "connector": "remote-fortisoar",
                "operation": "make_api_call",
                "operationTitle": "Make an API call",
                "pickFromTenant": false,
                "step_variables": {
                    "warroomsCount": "{{vars.steps.Warrooms.data['hydra:totalItems']}}"
                }
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "e0ccb1c3-f553-4269-bd5c-fbb5bb7b4501"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Active Incidents -> Record to update",
            "targetStep": "\/api\/3\/workflow_steps\/507faaf9-10da-44f1-a661-069b80f00b2a",
            "sourceStep": "\/api\/3\/workflow_steps\/db60d493-2b2f-4201-a639-44415959f6ed",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "b457b46d-afce-4c78-8f20-523212520643"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Alerts -> Indicators",
            "targetStep": "\/api\/3\/workflow_steps\/d836e8ce-bffb-4b7b-ba88-b18801aaa7f2",
            "sourceStep": "\/api\/3\/workflow_steps\/cab7efe7-798c-4984-921d-2baac71ab94d",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "0db1aa74-6d8d-4bd4-b517-fe3a8813782a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Alerts",
            "targetStep": "\/api\/3\/workflow_steps\/cab7efe7-798c-4984-921d-2baac71ab94d",
            "sourceStep": "\/api\/3\/workflow_steps\/3dfc147b-d616-40a8-8158-a2b25539e1b0",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "86b52f85-c635-40b6-b195-47caabd777aa"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Get Tenants Count",
            "targetStep": "\/api\/3\/workflow_steps\/b6011002-8390-4895-9338-e69dd05c2760",
            "sourceStep": "\/api\/3\/workflow_steps\/3dfc147b-d616-40a8-8158-a2b25539e1b0",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "59129229-7df8-4a3a-add4-fe259d0961d0"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Tenants Count -> Tenant",
            "targetStep": "\/api\/3\/workflow_steps\/1afa0ad3-c803-4e6d-a976-238a08df9e63",
            "sourceStep": "\/api\/3\/workflow_steps\/b6011002-8390-4895-9338-e69dd05c2760",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "a53e74f9-443f-4706-8f5e-1ab75d82ff9f"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Incidents -> Copy of Incidents",
            "targetStep": "\/api\/3\/workflow_steps\/e0ccb1c3-f553-4269-bd5c-fbb5bb7b4501",
            "sourceStep": "\/api\/3\/workflow_steps\/27e907f4-e4c4-46af-a782-a96f3fa30060",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "8eed9d58-a065-4c19-bdfc-de3f27de9e35"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Indicators -> Incidents",
            "targetStep": "\/api\/3\/workflow_steps\/27e907f4-e4c4-46af-a782-a96f3fa30060",
            "sourceStep": "\/api\/3\/workflow_steps\/d836e8ce-bffb-4b7b-ba88-b18801aaa7f2",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "386d8de2-398b-4544-b424-02fc34895722"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Record to update -> Update Site Data",
            "targetStep": "\/api\/3\/workflow_steps\/bb506c49-fa25-4250-87d7-7cbaa6c31a39",
            "sourceStep": "\/api\/3\/workflow_steps\/507faaf9-10da-44f1-a661-069b80f00b2a",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "33383eed-f746-40a7-a988-227f34fb9542"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/3dfc147b-d616-40a8-8158-a2b25539e1b0",
            "sourceStep": "\/api\/3\/workflow_steps\/5d464431-d509-4b23-866b-6cd18703e136",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "c7ce1f99-0403-4df0-825e-9b48f0231440"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Tenant Data -> Record to update",
            "targetStep": "\/api\/3\/workflow_steps\/507faaf9-10da-44f1-a661-069b80f00b2a",
            "sourceStep": "\/api\/3\/workflow_steps\/6ec1b065-4635-478d-84db-942a273e81b3",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "3dd68c9c-cfa6-4d50-bdc5-1412afbd9695"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Tenant -> Tenant Data",
            "targetStep": "\/api\/3\/workflow_steps\/6ec1b065-4635-478d-84db-942a273e81b3",
            "sourceStep": "\/api\/3\/workflow_steps\/1afa0ad3-c803-4e6d-a976-238a08df9e63",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "a091f26b-0f9a-4260-b82a-7817921ad23e"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Update Site Data -> Output",
            "targetStep": "\/api\/3\/workflow_steps\/bca368db-03af-4560-862e-c4b8aadd840d",
            "sourceStep": "\/api\/3\/workflow_steps\/bb506c49-fa25-4250-87d7-7cbaa6c31a39",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "7e56ae08-1a92-4073-8f10-6c5f99bb3bbc"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Warrooms -> Active Incidents",
            "targetStep": "\/api\/3\/workflow_steps\/db60d493-2b2f-4201-a639-44415959f6ed",
            "sourceStep": "\/api\/3\/workflow_steps\/e0ccb1c3-f553-4269-bd5c-fbb5bb7b4501",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "1c6a4d65-cae6-411c-a9d4-f84d26bdf7c2"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "ab27d7d4-7507-4b80-a9ee-118389611659",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": []
}